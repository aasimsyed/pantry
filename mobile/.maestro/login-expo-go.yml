# Login Flow Test - For Expo Go
# Use this when testing with Expo Go app

appId: host.exp.Exponent
---
- launchApp
# Wait a bit for Expo Go to load
- waitForAnimationToEnd:
    timeout: 3000
# Expo Go opens to project selector - tap our app to open it
- runFlow:
    when:
      visible: "Smart Pantry AI"
    commands:
      - tapOn: "Smart Pantry AI"
      - waitForAnimationToEnd:
          timeout: 5000
# Wait for app to load - check if already logged in or need to log in
- runFlow:
    when:
      visible: "Smart Pantry"
    commands:
      # Already logged in, verify home screen and we're done
      - assertVisible:
          id: "home-title"
      - assertVisible:
          id: "quick-action-inventory"
      - assertVisible:
          id: "quick-action-recipes"
# If not already logged in, do login flow
- runFlow:
    when:
      visible: "Sign In"
    commands:
      - assertVisible:
          id: "login-title"
      - assertVisible: "Email"
      - assertVisible: "Password"
      # Email: tap by id (testID), set clipboard, paste
      - tapOn:
          id: "email-input"
      - waitForAnimationToEnd:
          timeout: 2000
      - setClipboard: "admin@pantry.com"
      - pasteText
      # Password: tap by id (testID), set clipboard, paste
      - tapOn:
          id: "password-input"
      - waitForAnimationToEnd:
          timeout: 2000
      - setClipboard: "Admin12345"
      - pasteText
      # Dismiss keyboard so Sign In is tappable
      - waitForAnimationToEnd:
          timeout: 1000
      - hideKeyboard
      - tapOn:
          id: "login-button"
      # Wait for login to complete (API + navigation) before asserting
      - extendedWaitUntil:
          visible: "Smart Pantry"
          timeout: 15000
      # Dismiss iCloud "Save Password?" dialog if it appears (tap "Not Now")
      - runFlow:
          when:
            visible: "Not Now"
          commands:
            - tapOn: "Not Now"
      - assertVisible:
          id: "home-title"
      - assertVisible:
          id: "quick-action-inventory"
      - assertVisible:
          id: "quick-action-recipes"
