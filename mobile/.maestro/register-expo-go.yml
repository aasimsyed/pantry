# Registration Flow Test - For Expo Go
# Use this when testing with Expo Go app

appId: host.exp.Exponent
---
- launchApp
# Wait a bit for Expo Go to load
- waitForAnimationToEnd:
    timeout: 3000
# Expo Go opens to project selector - tap our app to open it
- runFlow:
    when:
      visible: "Smart Pantry AI"
    commands:
      - tapOn: "Smart Pantry AI"
      - waitForAnimationToEnd:
          timeout: 5000
# Wait for app to load - check if already logged in or need to log out
- runFlow:
    when:
      visible: "Smart Pantry"
    commands:
      # Already logged in, need to log out first to test registration
      - tapOn:
          id: "logout-button"
      - waitForAnimationToEnd:
          timeout: 2000
      - runFlow:
          when:
            visible: "Sign In"
          commands:
            # Successfully logged out, now on login screen
            - assertVisible:
                id: "login-title"
# If we're already on login screen (not logged in), proceed
- runFlow:
    when:
      visible: "Sign In"
    commands:
      - assertVisible:
          id: "login-title"
# Navigate to registration
- tapOn:
    id: "register-link"
- assertVisible:
    id: "register-title"
- assertVisible: "Email"
- assertVisible: "Password"
# Fill in registration form
- tapOn:
    id: "email-input"
- inputText: "newuser@example.com"
- tapOn:
    id: "password-input"
- inputText: "securepassword123"
- tapOn:
    id: "register-button"
# Handle result (success or error)
- runFlow:
    when:
      visible: "Smart Pantry"
    commands:
      - assertVisible:
          id: "home-title"
# Dismiss iCloud "Save Password?" dialog if it appears
- runFlow:
    when:
      visible: "Not Now"
    commands:
      - tapOn: "Not Now"
# If registration failed, error message should be visible
- runFlow:
    when:
      visible: "Registration failed"
    commands:
      - assertVisible: "Registration failed"
      # If registration failed, we're still on register screen, can navigate to login
      - tapOn:
          id: "login-link"
