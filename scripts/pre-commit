#!/bin/bash
# Pre-commit hook: run ESLint (including react-native-a11y) on staged mobile .ts/.tsx files.
# Install: cp scripts/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

PROJECT_ROOT="$(git rev-parse --show-toplevel)"
cd "$PROJECT_ROOT"

STAGED_MOBILE=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '^mobile/.*\.(ts|tsx)$' || true)
if [ -z "$STAGED_MOBILE" ]; then
  exit 0
fi

# Paths relative to mobile/ for eslint
FILES_FOR_LINT=$(echo "$STAGED_MOBILE" | sed 's|^mobile/||')
echo "üîç Linting staged mobile files (ESLint + react-native-a11y)..."
cd "$PROJECT_ROOT/mobile"
echo "$FILES_FOR_LINT" | xargs npx eslint --max-warnings 0
exit $?
